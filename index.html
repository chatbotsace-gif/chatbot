<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assistente Virtual Profissional</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:linear-gradient(135deg,#0f172a,#1e293b);color:#e2e8f0;display:flex;flex-direction:column;height:100vh;overflow:hidden;}
.header{padding:16px 20px;background:linear-gradient(135deg,#1e40af,#3b82f6);display:flex;align-items:center;gap:12px;box-shadow:0 2px 8px rgba(0,0,0,0.3);}
.logo{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#60a5fa,#3b82f6);font-size:20px;}
.header-title{flex:1;}
.header-title h1{font-size:18px;font-weight:600;}
.header-title p{font-size:12px;opacity:0.8;}
.status{font-size:12px;padding:4px 10px;border-radius:20px;background:rgba(16,185,129,0.2);border:1px solid rgba(16,185,129,0.3);}
.status-dot{width:8px;height:8px;background:#10b981;border-radius:50%;display:inline-block;margin-right:4px;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.5;}}
.quickActions{display:flex;gap:8px;overflow-x:auto;padding:8px 12px;background:rgba(15,23,42,0.9);scrollbar-width:thin;}
.quickActions button{padding:8px 14px;border:none;border-radius:20px;background:rgba(37,99,235,0.2);color:#93c5fd;font-size:13px;white-space:nowrap;cursor:pointer;transition:all 0.3s;}
.quickActions button:hover{background:rgba(59,130,246,0.3);transform:scale(1.05);}
.messages{flex:1;overflow-y:auto;padding:14px 14px 80px 14px;display:flex;flex-direction:column;gap:14px;scroll-behavior:smooth;}
.msg-wrapper{display:flex;gap:10px;animation:fadeIn 0.3s;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.msg-wrapper.me{flex-direction:row-reverse;}
.avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.avatar.user{background:linear-gradient(135deg,#8b5cf6,#6366f1);}
.avatar.bot{background:linear-gradient(135deg,#06b6d4,#0891b2);}
.msg{padding:10px 14px;border-radius:16px;max-width:75%;font-size:14px;line-height:1.5;word-wrap:break-word;}
.msg-wrapper.me .msg{background:linear-gradient(135deg,#8b5cf6,#6366f1);color:#fff;}
.msg-wrapper.bot .msg{background:rgba(30,41,59,0.8);border:1px solid rgba(59,130,246,0.2);}
.inputArea{display:flex;padding:10px;gap:8px;background:rgba(15,23,42,0.95);border-top:1px solid rgba(59,130,246,0.2);position:fixed;bottom:0;left:0;width:100%;backdrop-filter:blur(10px);}
.inputArea input{flex:1;padding:12px 16px;border-radius:24px;border:2px solid rgba(59,130,246,0.3);background:rgba(30,41,59,0.6);color:#e2e8f0;font-size:14px;outline:none;transition:border 0.3s;}
.inputArea input:focus{border-color:rgba(59,130,246,0.6);}
.inputArea button{padding:12px 18px;border:none;border-radius:24px;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.3s;}
.inputArea button:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(59,130,246,0.4);}
#micBtn{background:linear-gradient(135deg,#10b981,#059669);min-width:48px;}
#micBtn.recording{background:linear-gradient(135deg,#ef4444,#dc2626);animation:recordPulse 1s infinite;}
@keyframes recordPulse{0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}
</style>
</head>
<body>

<div class="header">
  <div class="logo">ü§ñ</div>
  <div class="header-title">
    <h1>Assistente Virtual</h1>
    <p>Fala, ouve e resolve c√°lculos!</p>
  </div>
  <div class="status"><span class="status-dot"></span>Online</div>
</div>

<div class="quickActions">
  <button onclick="sendQuick('Oi')">üëã Oi</button>
  <button onclick="sendQuick('Que horas s√£o?')">‚è∞ Hora</button>
  <button onclick="sendQuick('Qual a data de hoje?')">üìÖ Data</button>
  <button onclick="sendQuick('Me conte uma piada')">üòÑ Piada</button>
  <button onclick="sendQuick('10 + 25 * 2')">üßÆ C√°lculo</button>
  <button onclick="sendQuick('Qual a temperatura?')">üå°Ô∏è Clima</button>
</div>

<div id="messages" class="messages"></div>

<div class="inputArea">
  <input id="inputMsg" placeholder="Digite aqui..." autocomplete="off">
  <button id="micBtn">üé§</button>
  <button id="sendBtn">Enviar</button>
</div>

<script>
const messagesEl = document.getElementById('messages');
const input = document.getElementById('inputMsg');
const sendBtn = document.getElementById('sendBtn');
const micBtn = document.getElementById('micBtn');
let userName = null;
let isProcessing = false;

function addMessage(text, who='bot'){
  const wrap = document.createElement('div');
  wrap.className = 'msg-wrapper '+who;
  const avatar = document.createElement('div');
  avatar.className = 'avatar '+(who==='me'?'user':'bot');
  avatar.textContent = who==='me'?'üë§':'ü§ñ';
  const msg = document.createElement('div');
  msg.className = 'msg';
  msg.textContent = text;
  wrap.appendChild(avatar);
  wrap.appendChild(msg);
  messagesEl.appendChild(wrap);
  messagesEl.scrollTop = messagesEl.scrollHeight;
  if(who==='bot') speak(text);
}

function sendQuick(text){
  if(isProcessing) return;
  addMessage(text,'me');
  setTimeout(()=>botRespond(text), 300);
}

function speak(text){
  if(!window.speechSynthesis) return;
  speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'pt-BR'; 
  utter.rate = 0.95; 
  utter.pitch = 1;
  speechSynthesis.speak(utter);
}

micBtn.addEventListener('click', ()=>{
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition){
    addMessage("‚ö†Ô∏è Seu navegador n√£o suporta reconhecimento de voz. Use Chrome ou Edge!", 'bot');
    return;
  }
  const rec = new SpeechRecognition();
  rec.lang = 'pt-BR';
  rec.continuous = false;
  rec.interimResults = false;
  
  micBtn.classList.add('recording');
  
  rec.onresult = e=>{
    const transcript = e.results[0][0].transcript;
    input.value = transcript;
    micBtn.classList.remove('recording');
    handleSend();
  };
  
  rec.onerror = ()=>{
    micBtn.classList.remove('recording');
    addMessage("‚ùå Erro no reconhecimento de voz. Tente novamente!", 'bot');
  };
  
  rec.onend = ()=>{
    micBtn.classList.remove('recording');
  };
  
  rec.start();
});

function calcExpr(expr){
  try{
    const original = expr;
    expr = expr.replace(/\s+/g,''); 
    expr = expr.replace(/‚àö(\d+)/g,'Math.sqrt($1)');
    expr = expr.replace(/(\d+)\^(\d+)/g,'Math.pow($1,$2)');
    expr = expr.replace(/(\d+)!/g, (match,n)=>{
      let f=1;
      for(let i=1;i<=parseInt(n);i++) f*=i;
      return f;
    });
    expr = expr.replace(/log\(([^)]+)\)/g,'Math.log10($1)');
    expr = expr.replace(/ln\(([^)]+)\)/g,'Math.log($1)');
    
    const result = eval(expr);
    return `üßÆ ${original} = ${result}`;
  }catch(err){
    return null;
  }
}

function isCalculation(msg){
  const cleanMsg = msg.replace(/\s+/g,'');
  return /^[\d+\-*/().‚àö^!]+$/.test(cleanMsg) || 
         /log\(|ln\(/.test(cleanMsg) ||
         msg.includes('calcular') ||
         msg.includes('quanto √©');
}

async function botRespond(msg){
  if(isProcessing) return;
  isProcessing = true;
  
  let response = '';
  const msgLower = msg.toLowerCase().trim();

  if(isCalculation(msg)){
    const calcResult = calcExpr(msg);
    if(calcResult){
      response = calcResult;
    }
  }
  
  if(!response){
    if(!userName && !msgLower.includes('temperatura') && !msgLower.includes('clima') && !msgLower.includes('hora') && !msgLower.includes('data')){
      userName = msg.replace(/[^a-zA-Z√Ä-√ø\s]/g,'').trim();
      response = userName ? `Prazer em te conhecer, ${userName}! üòä Como posso te ajudar hoje?` : "Ol√°! Qual √© o seu nome? üòÑ";
    }
    else if(msgLower.includes("temperatura") || msgLower.includes("clima")){
      addMessage("üîç Consultando temperatura...", 'bot');
      const city = "S√£o Paulo";
      const lat = -23.5505;
      const lon = -46.6333;
      const api = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=celsius`;
      try{
        const res = await fetch(api);
        const data = await res.json();
        const temp = data.current_weather.temperature;
        response = `üå°Ô∏è A temperatura atual em ${city} √© ${temp}¬∞C.`;
        messagesEl.removeChild(messagesEl.lastChild);
      } catch(err){
        response = "‚ùå N√£o consegui obter a temperatura no momento. Tente novamente!";
        messagesEl.removeChild(messagesEl.lastChild);
      }
    }
    else if(msgLower.includes('oi')||msgLower.includes('ol√°')||msgLower.includes('ola')) {
      response = userName ? `Oi, ${userName}! üëã Tudo bem?` : "Oi! üëã Qual √© o seu nome?";
    }
    else if(msgLower.includes('hora')||msgLower.includes('horas')) {
      response = `‚è∞ Agora s√£o ${new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}.`;
    }
    else if(msgLower.includes('data')||msgLower.includes('dia')) {
      response = `üìÖ Hoje √© ${new Date().toLocaleDateString('pt-BR',{weekday:'long',day:'numeric',month:'long',year:'numeric'})}.`;
    }
    else if(msgLower.includes('piada')) {
      const piadas = [
        "üòÇ Por que o livro de matem√°tica ficou triste? Porque ele tinha muitos problemas!",
        "üòÑ Por que o computador foi ao m√©dico? Porque estava com v√≠rus!",
        "ü§£ O que o zero disse para o oito? Que cinto maneiro!",
        "üòÜ Por que a galinha atravessou a estrada? Para chegar do outro lado!"
      ];
      response = piadas[Math.floor(Math.random()*piadas.length)];
    }
    else if(msgLower.includes('obrigad')) {
      response = "üòä Por nada! Estou aqui para ajudar!";
    }
    else if(msgLower.includes('tchau')||msgLower.includes('at√©')) {
      response = "üëã At√© logo! Volte sempre!";
    }
    else {
      response = "ü§ñ Ainda estou aprendendo! Tente perguntar sobre hora, data, clima ou me pe√ßa para fazer um c√°lculo!";
    }
  }

  addMessage(response, 'bot');
  isProcessing = false;
}

function handleSend(){
  const text = input.value.trim();
  if(!text || isProcessing) return;
  addMessage(text,'me');
  input.value = '';
  setTimeout(()=>botRespond(text), 300);
}

sendBtn.addEventListener('click', handleSend);
input.addEventListener('keypress', e=>{if(e.key==='Enter') handleSend();});

setTimeout(()=>addMessage('Ol√°! üëã Seja bem-vindo(a)! Qual √© o seu nome? üòä'), 500);
</script>

</body>
</html>
